Port : 14457

Action flyTo(position){
    /* 调用神经网络指导无人机飞往目的地 */
    := FlyAPI_Model(position);
}

Action pickUp(){
    /* 调用既定动作 */
    := pickUpAPI();
}

Action drop(){
    /* 调用既定动作 */
    := dropAPI();
}

Action chooseDest(){
    /* dst 接收调用结果，一个目的地 */
    dst := chooseDestAPI();
    /* 将 dst 返回给调用者 */
    return dst;
}

Agent Uav {
    flyTo, pickUp, drop, chooseDest;
}

Behavior delivering() {
    @init{
        pickup();
        dest = chooseDest();
    }
    @goal{
        loc = getGPS();
        $ dest == loc
    }
    @routine{
        flyTo(dest);
    }
}

Behavior dropGood() {
    @init{}
    @goal{}
    @routine{
        drop();
        get delivery_cnt from #delivery_count# ;
        put delivery_cnt+1 to #delivery_count#
    }
}

Task delivery({uavA:countA}, goods_cnt){
    @init{
        put 0 to #delivery_count# ;
    }
    @goal{
        get delivery_cnt from #delivery_count# ;
        $ delivery_cnt == goods_cnt
    }
    @routine{
        order uavA[0~countA]{
            delivering();
            dropGood();
        }
    }
}

Main {
    Agent Uav 5;
    delivery({Uav:5}, 20);
}