Port : 14457

Action flyTo(position){
    step := nn_model(position);
    := fly(step);
}

Action pickUp(){
    := pickUpAPI();
}

Action drop(){
    := dropAPI();
}

Action chooseDest(){
    dst := chooseDestAPI();
    return dst;
}

Agent Uav {
    flyTo, pickUp, drop, chooseDest;
}

Behavior delivering() {
    @init{
        pickup();
        dest = chooseDest();
    }
    @goal{
        loc = getGPS();
        $ dest == loc
    }
    @routine{
        flyTo(dest);
    }
}

Behavior dropGood() {
    @init{}
    @goal{}
    @routine{
        drop();
        get delivery_cnt from #delivery_count# ;
        put delivery_cnt+1 to #delivery_count#
    }
}

Task delivery({uavA:countA}, goods_cnt){
    @init{
        put 0 to #delivery_count# ;
    }
    @goal{
        get delivery_cnt from #delivery_count# ;
        $ delivery_cnt == goods_cnt
    }
    @routine{
        order uavA[0~countA]{
            delivering();
            dropGood();
        }
    }
}

Main {
    Agent Uav 5;
    delivery({Uav:5}, 20);
}